# Kubernetes Secrets for Airflow POC
# Store sensitive credentials separately from config files
#
# IMPORTANT SECURITY NOTES:
# 1. This file contains base64-encoded values (NOT encrypted at rest by default)
# 2. For production, use one of these secure options:
#    - Azure Key Vault with CSI Driver
#    - Sealed Secrets (bitnami-labs/sealed-secrets)
#    - External Secrets Operator
#    - HashiCorp Vault
# 3. Never commit actual secrets to Git - use this as a template
#
# To create secrets from your .env file:
#   kubectl create secret generic airflow-secrets -n airflow \
#     --from-env-file=.env \
#     --dry-run=client -o yaml > kubernetes/secrets-generated.yaml
#
# To apply secrets:
#   kubectl apply -f kubernetes/secrets.yaml

---
apiVersion: v1
kind: Secret
metadata:
  name: airflow-connections
  namespace: airflow
  labels:
    app: airflow
    component: secrets
type: Opaque
stringData:
  # On-Premises Database Connection
  # Format: <conn_type>://<user>:<password>@<host>:<port>/<database>
  AIRFLOW_CONN_ONPREM_DB: "mssql://CHANGE_ME_USER:CHANGE_ME_PASSWORD@on-prem-server.company.com:1433/sales_db"
  
  # Azure Storage Connection
  # Format: wasb://<container>@<storage_account>.blob.core.windows.net
  AIRFLOW_CONN_AZURE_DEFAULT: "wasb://?connection_string=DefaultEndpointsProtocol%3Dhttps%3BAccountName%3DCHANGE_ME%3BAccountKey%3DCHANGE_ME%3BEndpointSuffix%3Dcore.windows.net"
  
  # Databricks Connection
  # Format: databricks://<host>?token=<token>
  AIRFLOW_CONN_DATABRICKS_DEFAULT: "databricks://CHANGE_ME_HOST?token=CHANGE_ME_TOKEN"
  
  # Power BI Connection (using generic HTTP)
  # Store as JSON in Variable instead, or use custom connection
  AIRFLOW_CONN_POWERBI_DEFAULT: "http://?extra__http__auth_type=bearer&extra__http__bearer_token=CHANGE_ME_TOKEN"

---
apiVersion: v1
kind: Secret
metadata:
  name: airflow-variables
  namespace: airflow
  labels:
    app: airflow
    component: secrets
type: Opaque
stringData:
  # Power BI Configuration (used in DAG)
  powerbi_workspace_id: "CHANGE_ME_WORKSPACE_ID"
  powerbi_dataset_id: "CHANGE_ME_DATASET_ID"
  powerbi_tenant_id: "CHANGE_ME_TENANT_ID"
  powerbi_client_id: "CHANGE_ME_CLIENT_ID"
  powerbi_client_secret: "CHANGE_ME_CLIENT_SECRET"
  
  # Azure Storage Configuration
  azure_storage_account: "CHANGE_ME_STORAGE_ACCOUNT"
  azure_container_staging: "staging"
  
  # Databricks Configuration
  databricks_workspace_url: "https://CHANGE_ME.cloud.databricks.com"
  databricks_cluster_id: "CHANGE_ME_CLUSTER_ID"

---
apiVersion: v1
kind: Secret
metadata:
  name: git-credentials
  namespace: airflow
  labels:
    app: airflow
    component: git-sync
type: Opaque
stringData:
  # GitHub credentials for git-sync (only needed for private repos)
  GITSYNC_USERNAME: "CHANGE_ME_GITHUB_USERNAME"
  GITSYNC_PASSWORD: "CHANGE_ME_GITHUB_PAT"

---
# Database credentials (if not using Helm chart defaults)
apiVersion: v1
kind: Secret
metadata:
  name: postgres-credentials
  namespace: airflow
  labels:
    app: airflow
    component: database
type: Opaque
stringData:
  POSTGRES_USER: "airflow"
  POSTGRES_PASSWORD: "CHANGE_ME_POSTGRES_PASSWORD"
  POSTGRES_DB: "airflow"
