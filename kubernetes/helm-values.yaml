# Apache Airflow Helm chart values (parity with current K8s manifests)

# Disable embedded Postgres; use existing postgres service in airflow namespace
postgresql:
  enabled: false

# External DB connections
# NOTE: Passwords should be moved to Kubernetes Secrets for production
# See kubernetes/secrets.yaml and docs/SECRETS_MANAGEMENT.md
airflowVersion: "2.9.3"
executor: CeleryExecutor
data:
  metadataConnection:
    protocol: postgresql
    host: postgres
    port: 5432
    db: airflow
    user: airflow
    pass: airflow  # TODO: Move to secret - see kubernetes/secrets.yaml
  resultBackendConnection:
    protocol: postgresql
    host: postgres
    port: 5432
    db: airflow
    user: airflow
    pass: airflow  # TODO: Move to secret - see kubernetes/secrets.yaml
    sslmode: disable

# Enable Redis for CeleryExecutor
redis:
  enabled: true

# Airflow image (match raw manifests)
images:
  airflow:
    repository: apache/airflow
    tag: 2.9.3
    pullPolicy: IfNotPresent

# Executor & Core config overrides
config:
  core:
    executor: CeleryExecutor
    load_examples: "False"
  celery:
    worker_concurrency: 4

# Webserver settings and default admin user
# NOTE: Admin password should be moved to Kubernetes Secret for production
webserver:
  enabled: true
  replicas: 1
  service:
    type: LoadBalancer
  defaultUser:
    enabled: true
    username: admin
    password: "NewStrongPass#2025"  # TODO: Move to secret - see kubernetes/secrets.yaml
    role: Admin
    email: admin@example.com
    firstName: Admin
    lastName: User
  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1024Mi

# DAGs and logs persistence disabled for POC
dags:
  persistence:
    enabled: false
  gitSync:
    enabled: true
    repo: "https://github.com/jogusrikanth-code/Airflow_POC.git"
    branch: "master"
    subPath: "."        # sync entire repo so `src/` is importable
    depth: 1
    wait: 60
    # Public repo: no credentials needed. For private, set `credentialsSecret`.
logs:
  persistence:
    enabled: false

scheduler:
  replicas: 1
  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1024Mi

workers:
  replicas: 1
  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1024Mi

# Security: run as airflow user (non-root)
airflowUser: 50000

flower:
  enabled: false